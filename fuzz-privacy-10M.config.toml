# Extended Privacy Fuzz Campaign Configuration - 10M+ Iterations
# Total estimated iterations: 10,150,000
# Total estimated time: ~14 days continuous

[profile.privacy-10M]
fuzz = { runs = 2000000, max_test_rejects = 1000000 }
invariant = { runs = 100000, depth = 200 }

# ============================================================================
# CAMPAIGN 1: STEALTH ADDRESSES (2M iterations)
# ============================================================================

[campaign.stealth-extended]
name = "Extended Stealth Address Campaign"
runs = 2000000
timeout = 259200  # 72 hours
target = "test/fuzz/StealthAddressFuzz.t.sol"
workers = 8

[campaign.stealth-extended.mutations]
viewTag = { type = "uint8", range = [0, 255], coverage = "exhaustive" }
ephemeralKeyX = { type = "uint256", strategy = "random", entropy = "high" }
ephemeralKeyY = { type = "uint256", strategy = "random", entropy = "high" }
spendingPubKeyX = { type = "uint256", strategy = "boundary", boundaries = [0, 1, "MAX-1", "MAX"] }
spendingPubKeyY = { type = "uint256", strategy = "boundary", boundaries = [0, 1, "MAX-1", "MAX"] }
viewingPubKeyX = { type = "uint256", strategy = "mixed" }
viewingPubKeyY = { type = "uint256", strategy = "mixed" }
batchSize = { type = "uint8", range = [1, 100] }
recipient = { type = "address", strategy = "random" }

[campaign.stealth-extended.invariants]
determinism = "invariant_stealthDeterminism"
unlinkability = "invariant_stealthUnlinkability"
viewTagCoverage = "invariant_viewTagCoverage"
noCollisions = "invariant_noStealthCollisions"

# ============================================================================
# CAMPAIGN 2: RING CONFIDENTIAL TRANSACTIONS (1.5M iterations)
# ============================================================================

[campaign.ringct-extended]
name = "Extended RingCT Campaign"
runs = 1500000
timeout = 345600  # 96 hours
target = "test/fuzz/RingCTFuzz.t.sol"
workers = 8

[campaign.ringct-extended.mutations]
ringSize = { type = "uint8", range = [2, 16], distribution = "weighted", weights = [10, 20, 30, 20, 10, 5, 3, 2] }
inputCount = { type = "uint8", range = [1, 4] }
outputCount = { type = "uint8", range = [1, 4] }
inputAmounts = { type = "uint256[]", length = [1, 4], max_value = "10e18", min_value = "1000" }
outputAmounts = { type = "uint256[]", length = [1, 4], max_value = "10e18" }
blindingFactors = { type = "bytes32[]", length = [1, 8], strategy = "random" }
keyImages = { type = "bytes32[]", length = [1, 4], strategy = "unique" }
decoyIndices = { type = "uint8[]", length = [2, 16], range = [0, 15] }
feeAmount = { type = "uint256", range = [0, "1e16"] }

[campaign.ringct-extended.invariants]
balanceConservation = "invariant_ringCTBalance"
keyImageUniqueness = "invariant_keyImageUniqueness"
ringAnonymity = "invariant_ringAnonymity"
rangeProofSoundness = "invariant_rangeProofs"

# ============================================================================
# CAMPAIGN 3: NULLIFIERS (3M iterations)
# ============================================================================

[campaign.nullifiers-extended]
name = "Extended Nullifier Campaign"
runs = 3000000
timeout = 259200  # 72 hours
target = "test/fuzz/NullifierFuzz.t.sol"
workers = 8

[campaign.nullifiers-extended.mutations]
secret = { type = "bytes32", strategy = "random", entropy = "cryptographic" }
commitment = { type = "bytes32", strategy = "random" }
sourceDomain = { type = "uint256", range = [1, 100000] }
targetDomain = { type = "uint256", range = [1, 100000] }
epochId = { type = "uint256", range = [1, 10000000] }
appId = { type = "bytes32", strategy = "random" }
chainId = { type = "uint256", range = [1, 1000000] }
timestamp = { type = "uint256", range = [1000000000, 2000000000] }

[campaign.nullifiers-extended.invariants]
determinism = "invariant_nullifierDeterminism"
uniqueness = "invariant_nullifierUniqueness"
domainIsolation = "invariant_domainIsolation"
crossDomainAsymmetry = "invariant_crossDomainAsymmetry"
pilBindingDeterminism = "invariant_pilBindingDeterminism"
noDoubleSpend = "invariant_noDoubleSpend"

# ============================================================================
# CAMPAIGN 4: HOMOMORPHIC COMMITMENTS (1M iterations)
# ============================================================================

[campaign.homomorphic-extended]
name = "Extended Homomorphic Commitment Campaign"
runs = 1000000
timeout = 172800  # 48 hours
target = "test/fuzz/HomomorphicFuzz.t.sol"
workers = 8

[campaign.homomorphic-extended.mutations]
value1 = { type = "uint256", max_value = "10e18", distribution = "log_uniform" }
value2 = { type = "uint256", max_value = "10e18", distribution = "log_uniform" }
blinding1 = { type = "bytes32", strategy = "random" }
blinding2 = { type = "bytes32", strategy = "random" }
generatorH = { type = "uint256", strategy = "fixed", value = "PEDERSEN_H" }
generatorG = { type = "uint256", strategy = "fixed", value = "PEDERSEN_G" }

[campaign.homomorphic-extended.invariants]
additivity = "invariant_commitmentAdditivity"
determinism = "invariant_commitmentDeterminism"
binding = "invariant_commitmentBinding"
hiding = "invariant_commitmentHiding"

# ============================================================================
# CAMPAIGN 5: PRIVATE RELAYER NETWORK (500K iterations)
# ============================================================================

[campaign.relayer-extended]
name = "Extended Private Relayer Campaign"
runs = 500000
timeout = 86400  # 24 hours
target = "test/fuzz/RelayerNetworkFuzz.t.sol"
workers = 8

[campaign.relayer-extended.mutations]
relayerStake = { type = "uint256", range = ["1e18", "100e18"], distribution = "log_uniform" }
relayerCount = { type = "uint8", range = [1, 100] }
feeAmount = { type = "uint256", range = [0, "1e17"] }
commitHash = { type = "bytes32", strategy = "random" }
revealDelay = { type = "uint256", range = [1, 200] }
reputationScore = { type = "uint256", range = [0, 10000] }

[campaign.relayer-extended.invariants]
mevProtection = "invariant_mevProtection"
stakeRequirement = "invariant_stakeRequirement"
feeBounds = "invariant_feeBounds"
reputationTracking = "invariant_reputationTracking"
slashingCorrectness = "invariant_slashingCorrectness"

# ============================================================================
# CAMPAIGN 6: CROSS-CHAIN PRIVACY HUB (1M iterations)
# ============================================================================

[campaign.privacy-hub-extended]
name = "Extended Cross-Chain Privacy Hub Campaign"
runs = 1000000
timeout = 172800  # 48 hours
target = "test/fuzz/PrivacyHubFuzz.t.sol"
workers = 8

[campaign.privacy-hub-extended.mutations]
sourceChain = { type = "uint256", values = [1, 10, 42161, 8453, 137, 324, 534352, 59144] }
targetChain = { type = "uint256", values = [1, 10, 42161, 8453, 137, 324, 534352, 59144] }
proof = { type = "bytes", length = [32, 2048], strategy = "random" }
publicInputs = { type = "uint256[]", length = [1, 32], strategy = "random" }
privacyLevel = { type = "uint8", range = [0, 3] }
commitment = { type = "bytes32", strategy = "random" }
nullifier = { type = "bytes32", strategy = "random" }

[campaign.privacy-hub-extended.invariants]
crossChainConsistency = "invariant_crossChainConsistency"
proofVerification = "invariant_proofVerification"
nullifierSync = "invariant_nullifierSync"
privacyLevelEnforcement = "invariant_privacyLevelEnforcement"

# ============================================================================
# CAMPAIGN 7: TRIPTYCH SIGNATURES (500K iterations)
# ============================================================================

[campaign.triptych-extended]
name = "Extended Triptych Signature Campaign"
runs = 500000
timeout = 86400  # 24 hours
target = "test/fuzz/TriptychFuzz.t.sol"
workers = 8

[campaign.triptych-extended.mutations]
ringSize = { type = "uint16", values = [4, 8, 16, 32, 64, 128, 256] }
signerIndex = { type = "uint8", strategy = "random_within_ring" }
message = { type = "bytes32", strategy = "random" }
privateKey = { type = "bytes32", strategy = "random" }
publicKeys = { type = "bytes32[]", strategy = "unique_random" }

[campaign.triptych-extended.invariants]
logarithmicProofSize = "invariant_triptychProofSize"
keyImageConsistency = "invariant_keyImageConsistency"
verificationCorrectness = "invariant_triptychVerification"

# ============================================================================
# CAMPAIGN 8: SERAPHIS ADDRESSING (350K iterations)
# ============================================================================

[campaign.seraphis-extended]
name = "Extended Seraphis Addressing Campaign"
runs = 350000
timeout = 86400  # 24 hours
target = "test/fuzz/SeraphisFuzz.t.sol"
workers = 8

[campaign.seraphis-extended.mutations]
spendKey = { type = "bytes32", strategy = "random" }
viewKey = { type = "bytes32", strategy = "random" }
generateKey = { type = "bytes32", strategy = "random" }
ephemeralSecret = { type = "bytes32", strategy = "random" }
subaddressIndex = { type = "uint32", range = [0, 4294967295] }
accountIndex = { type = "uint32", range = [0, 1000000] }

[campaign.seraphis-extended.invariants]
threeKeyConsistency = "invariant_seraphisKeys"
subaddressUnlinkability = "invariant_subaddressUnlinkability"
forwardSecrecy = "invariant_forwardSecrecy"

# ============================================================================
# CAMPAIGN 9: FHE OPERATIONS (300K iterations)
# ============================================================================

[campaign.fhe-extended]
name = "Extended FHE Operations Campaign"
runs = 300000
timeout = 86400  # 24 hours
target = "test/fuzz/FHEFuzz.t.sol"
workers = 8

[campaign.fhe-extended.mutations]
operation = { type = "uint8", range = [0, 19] }  # 20 FHE operations
operand1 = { type = "bytes", length = [32, 256], strategy = "encrypted" }
operand2 = { type = "bytes", length = [32, 256], strategy = "encrypted" }
ciphertextType = { type = "uint8", range = [0, 6] }  # EUINT8-256, EBOOL, EADDRESS

[campaign.fhe-extended.invariants]
operationConsistency = "invariant_fheOperationConsistency"
ciphertextValidity = "invariant_ciphertextValidity"
oracleIntegrity = "invariant_oracleIntegrity"

# ============================================================================
# ECHIDNA EXTENDED CONFIGURATION
# ============================================================================

[echidna.extended]
testLimit = 5000000
seqLen = 500
shrinkLimit = 20000
timeout = 604800  # 7 days
workers = 16
corpus_dir = "echidna-corpus/privacy-extended"

[echidna.extended.filter]
contracts = [
    "GasOptimizedStealthRegistry",
    "GasOptimizedNullifierManager",
    "GasOptimizedRingCT",
    "StealthAddressRegistry",
    "RingConfidentialTransactions",
    "UnifiedNullifierManager",
    "CrossChainPrivacyHub",
    "HomomorphicBalanceVerifier",
    "MLSAGSignatures",
    "TriptychSignatures",
    "NovaRecursiveVerifier",
    "SeraphisAddressing",
    "FHEPrivacyIntegration",
    "PrivateRelayerNetwork",
    "ViewKeyRegistry"
]

# ============================================================================
# MEDUSA EXTENDED CONFIGURATION
# ============================================================================

[medusa.extended]
workers = 16
timeout = 604800  # 7 days
test_limit = 3000000
call_sequence_length = 400

[medusa.extended.coverage]
enabled = true
corpus_directory = "medusa-corpus/privacy-extended"
html_report = true

# ============================================================================
# AGGREGATE STATISTICS
# ============================================================================

[statistics]
total_runs = 10150000  # 10M+ total iterations
estimated_time_days = 14
coverage_target = 99
mutation_strategies = ["random", "boundary", "arithmetic", "bitflip", "dictionary", "havoc"]
parallel_campaigns = 8

# ============================================================================
# REPORTING
# ============================================================================

[reporting]
output_dir = "fuzzing-results/privacy-10M"
format = ["json", "html", "markdown", "csv"]
include_coverage = true
include_corpus = true
include_gas_metrics = true
alert_on_failure = true
alert_threshold_gas = 500000
slack_webhook = "${SLACK_WEBHOOK_URL}"
email_recipients = ["security@pilprotocol.io"]

# ============================================================================
# CI/CD INTEGRATION
# ============================================================================

[ci]
quick_run = 100000  # For CI: 100k iterations in ~1 hour
full_run = 10150000  # For nightly: full campaign
schedule = "0 0 * * *"  # Daily at midnight

[ci.thresholds]
min_coverage = 95
max_gas_regression = 10  # percent
max_invariant_violations = 0

# ============================================================================
# RUN COMMANDS
# ============================================================================

# Quick run (CI):
# forge test --match-path "test/fuzz/*" --fuzz-runs 100000

# Extended run (Nightly):
# ./scripts/run-extended-fuzz.sh privacy-10M

# Echidna extended:
# echidna . --config fuzz-privacy-10M.config.toml --contract PrivacyFuzzTarget

# Medusa extended:
# medusa fuzz --config fuzz-privacy-10M.config.toml
